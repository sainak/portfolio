---
import type { Repository } from "../api/githubRepoApi"
import Icon from "./Icon.astro"

export interface Props {
  repo: Repository
}
const { repo } = Astro.props

const repoUrl = `https://github.com/${repo.owner.login}/${repo.name}`
const languagesTotal = repo.languages.totalSize
---

<div class="bg-white text-black h-full">
  <div class="flex overflow-hidden h-2">
    {
      repo.languages.edges
        .sort((a, b) => b.size - a.size)
        .map((language) => {
          return (
            <a
              style={`background-color:${
                language.node.color
              } !important;;width: ${(language.size / languagesTotal) * 100}%`}
              href={`${repoUrl}/search?l=${language.node.name}`}
              target="_blank"
            />
          )
        })
    }
  </div>
  <div class="px-4 py-6">
    <a href={repoUrl} target="_blank">
      <span class="text-xl">
        {repo.owner.login}/<span class="font font-bold">{repo.name}</span>
      </span>
    </a>
    {
      repo.homepageUrl && (
        <a href={repo.homepageUrl} target="_blank">
          <Icon name="external-link" class="inline h-5 w-5" />
        </a>
      )
    }
    {repo.description && <p class="mt-2">{repo.description}</p>}
    {
      repo.repositoryTopics.nodes.length > 0 && (
        <div class="flex flex-wrap mt-2 gap-2">
          {repo.repositoryTopics.nodes.map((topic) => {
            return (
              <a
                href={`https://github.com/search?q=user%3A${repo.owner.login}+${topic.topic.name}`}
                class="px-3 rounded-full border border-gray-300 text-sm w-max cursor-pointer active:bg-gray-300 transform transition duration-300 ease-in-out"
                target="_blank"
              >
                {topic.topic.name}
              </a>
            )
          })}
        </div>
      )
    }
  </div>
</div>
